{% extends "adminpages/admin_header_footer.html" %}
{% load static %}

{% block title %}Manage Workers{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item active" aria-current="page">Manage Workers</li>
{% endblock %}

{% block content %}
<style>
    /* Overriding default DataTable styles for the dark theme */
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_processing,
    .dataTables_wrapper .dataTables_paginate {
        color: var(--text-secondary) !important;
    }

    .dataTables_wrapper .dataTables_length select {
        background-color: var(--dark-bg-primary) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
    }

    .dataTables_wrapper .dataTables_filter input {
        background-color: var(--dark-bg-primary) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        color: var(--text-secondary) !important;
        border: 1px solid var(--border-color) !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        background: var(--primary-color) !important;
        color: var(--text-primary) !important;
        border-color: var(--primary-color) !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background: var(--border-color) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
    }
</style>

<div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
    <h1 class="page-title mb-0">Manage Service Providers</h1>
    <a href="{% url 'Worker_Register' %}" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Add New Worker</a>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table id="workersTable" class="table table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th>Provider</th>
                        <th>Designation</th>
                        <th>Contact</th>
                        <th>Verification Status</th>
                        <th>Availability</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for worker in workers_records %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="{{ worker.profile_pic.url }}" class="rounded-circle" width="45" height="45" alt="{{ worker.admin.get_full_name }}">
                                <div class="ms-3">
                                    <p class="fw-bold mb-1 text-white">{{ worker.admin.get_full_name }}</p>
                                    <p class="text-muted mb-0">{{ worker.admin.email }}</p>
                                </div>
                            </div>
                        </td>
                        <td>{{ worker.designation }}</td>
                        <td>{{ worker.contact_number }}</td>
                        <td>
                            {% if worker.acc_activation %}
                                <span class="badge bg-success-subtle text-success-emphasis p-2"><i class="fas fa-check-circle me-1"></i>Verified</span>
                            {% else %}
                                <span class="badge bg-danger-subtle text-danger-emphasis p-2"><i class="fas fa-times-circle me-1"></i>Not Verified</span>
                            {% endif %}
                        </td>
                        <td>
                             {% if worker.avalability_status %}
                                <span class="badge bg-light bg-opacity-10 text-light p-2">Available</span>
                            {% else %}
                                <span class="badge bg-secondary-subtle text-secondary-emphasis p-2">Unavailable</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            {% if not worker.acc_activation %}
                                <a href="{% url 'verify_worker' action='active' id=worker.id %}" class="btn btn-sm btn-success">
                                    <i class="fas fa-user-check me-1"></i> Verify
                                </a>
                            {% else %}
                                <span class="text-secondary fst-italic">No actions</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.min.js"></script>
<script>
    $(document).ready(function() {
        $('#workersTable').DataTable({
            // You can add options here, e.g., for ordering
            "order": [[ 3, "asc" ]] // Order by "Verification Status" column ascending by default
        });
    });
</script>

{% endblock %}